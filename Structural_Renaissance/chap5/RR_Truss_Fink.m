% script RR_Truss_Fink.m
% Set up a Fink truss, solve for its internal forces, and plot
%% Renaissance Repository, https://github.com/tbewley/RR (Structural Renaissance, Chapter 6)
%% Copyright 2025 by Thomas Bewley, and published under the BSD 3-Clause LICENSE

S.P=[  0  30;   % Columns denote (x,y) locations of each of the p=2 fixed nodes (normalized)
       0   0];
S.Q=[ 7.5 10  15  20 22.5 ;    % Locations of each of the n=5 free nodes (normalized)
      2.5  0   5   0  2.5];
L.U=[  0   0   0   0   0  ;    % External forces on the n free nodes of the truss (normalized)
     -650  0 -650  0 -650];     
S.C=[  1  -1   0   0   0   0   0;  % Connectivity of the truss
       0   1  -1   0   0   0   0;  % Note: each of the m rows of C
       0   0   1  -1   0   0   0;  % has exactly one entry equal to +1
       0   0   0   1  -1   0   0;  % and one entry equal to -1, indicating
       0  -1   0   0   0   1   0;  % which two nodes that that member connects.
       0   1   0  -1   0   0   0;   
       0   0   0   1   0   0  -1;   
      -1   0   0   0   0   1   0;   
       1   0  -1   0   0   0   0;   
       0   0   1   0  -1   0   0;   
       0   0   0   0   1   0  -1]; 
[A,b,S,L]=RR_Structure_Analyze(S,L); 
x=pinv(A)*b; error=norm(A*x-b)       % solve, assuming zero pretension
figure(1); RR_Structure_Plot(S,L,x); 
pause

% Now, analyze as a frame.
C=abs(C); P=[0; 0]; R=[30; 0];
% Now, convert the linear eqns for computing the interior forces in the frame
% into standard A*x=u form
[A,b]=RR_Convert_Frame_to_Ax_eq_b(Q,C,U,P,[],R); 
% Then, solve for the interior forces in the frame
x=pinv(A)*b; error=norm(A*x-b)
if error>1e-8, disp('No equilibrium solution'), else, figure(2); RR_Plot_Frame(Q,C,U,x,P,R), end
    pause

P=[  0   0   0   0;   
     0   6  12  18;
     0   0   0   0];
R=[ 30  30  30  30  10 20;   
     0   6  12  18  18 18;
     0   0   0   0   0  0];      
Q=[ 7.5 10  15  20 22.5  7.5 10  15  20 22.5  7.5 10  15  20 22.5  7.5  15  22.5;
     0   0   0   0   0    6   6   6   6   6   12  12  12  12  12   18   18   18  
    2.5  0   5   0  2.5  2.5  0   5   0  2.5  2.5  0   5   0  2.5  2.5   5   2.5];
U=[  0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  ;    
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  ;
   -325  0 -325  0 -325 -650  0 -650  0 -650 -650  0 -650  0 -650 -325 -325 -325];     
C =[ 1  -1   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   1  -1   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   1  -1   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   1  -1    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0  -1   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  1  0  0  0  0  0  0  0  0  0;  
     0   1   0  -1   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;   
     0   0   0   1   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0 -1  0  0  0  0  0;   
    -1   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  1  0  0  0  0  0  0  0  0  0;   
     1   0  -1   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;   
     0   0   1   0  -1    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;   
     0   0   0   0   1    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0 -1  0  0  0  0  0; 
     0   0   0   0   0    1  -1   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   1  -1   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   1  -1   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   1  -1    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0  -1   0   0   0    0   0   0   0   0    0    0    0  0  1  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   1   0  -1   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;   
     0   0   0   0   0    0   0   0   1   0    0   0   0   0   0    0    0    0  0  0  0  0  0 -1  0  0  0  0;   
     0   0   0   0   0   -1   0   0   0   0    0   0   0   0   0    0    0    0  0  1  0  0  0  0  0  0  0  0;   
     0   0   0   0   0    1   0  -1   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;   
     0   0   0   0   0    0   0   1   0  -1    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;   
     0   0   0   0   0    0   0   0   0   1    0   0   0   0   0    0    0    0  0  0  0  0  0 -1  0  0  0  0;
     0   0   0   0   0    0   0   0   0   0    1  -1   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0   1  -1   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0   0   1  -1   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0   0   0   1  -1    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0  -1   0   0   0    0    0    0  0  0  1  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0   1   0  -1   0    0    0    0  0  0  0  0  0  0  0  0  0  0;   
     0   0   0   0   0    0   0   0   0   0    0   0   0   1   0    0    0    0  0  0  0  0  0  0 -1  0  0  0;   
     0   0   0   0   0    0   0   0   0   0   -1   0   0   0   0    0    0    0  0  0  1  0  0  0  0  0  0  0;   
     0   0   0   0   0    0   0   0   0   0    1   0  -1   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;   
     0   0   0   0   0    0   0   0   0   0    0   0   1   0  -1    0    0    0  0  0  0  0  0  0  0  0  0  0;   
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   1    0    0    0  0  0  0  0  0  0 -1  0  0  0;
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    1    0    0  0  0  0  0  0  0  0  0 -1  0;  
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0   -1    0  0  0  0  0  0  0  0  0  1  0;  
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    1    0  0  0  0  0  0  0  0  0  0 -1;  
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0   -1  0  0  0  0  0  0  0  0  0  1;  
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  1  0  0  0  0 -1  0;  
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  1 -1;   
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0 -1  0  1;   
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0   -1    0    0  0  0  0  1  0  0  0  0  0  0;   
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    1   -1    0  0  0  0  0  0  0  0  0  0  0;   
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    1   -1  0  0  0  0  0  0  0  0  0  0;   
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    1  0  0  0  0  0  0  0 -1  0  0;
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  1 -1  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  1 -1  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  1 -1  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  1 -1  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  1 -1  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  1 -1  0  0;
     1   0   0   0   0   -1   0   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    1   0   0   0   0   -1   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    1   0   0   0   0   -1    0    0  0  0  0  0  0  0  0  0  0  0;
     0   1   0   0   0    0  -1   0   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   1   0   0   0    0  -1   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0   1   0   0   0    0    0    0  0  0  0  0  0  0  0  0 -1  0;
     0   0   1   0   0    0   0  -1   0   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   1   0   0    0   0  -1   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0   0   1   0   0    0   -1    0  0  0  0  0  0  0  0  0  0  0;
     0   0   0   1   0    0   0   0  -1   0    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   1   0    0   0   0  -1   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0   0   0   1   0    0    0    0  0  0  0  0  0  0  0  0  0 -1;
     0   0   0   0   1    0   0   0   0  -1    0   0   0   0   0    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   1    0   0   0   0  -1    0    0    0  0  0  0  0  0  0  0  0  0  0;  
     0   0   0   0   0    0   0   0   0   0    0   0   0   0   1    0    0   -1  0  0  0  0  0  0  0  0  0  0];      

% Now, analyze as a frame.
C=abs(C);
% Now, convert the linear eqns for computing the interior forces in the frame
% into standard A*x=u form
[A,b]=RR_Convert_Frame_to_Ax_eq_b(Q,C,U,P,[],R); 
% Then, solve for the interior forces in the frame
x=pinv(A)*b; error=norm(A*x-b), figure(3), RR_Plot_Frame(Q,C,U,x,P,R)
